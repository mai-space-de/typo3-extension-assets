<html
    xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
    data-namespace-typo3-fluid="true"
>
<!--
    Example Partial: SiteHeader.html
    ==================================
    Demonstrates registering SVG icons in a partial and scoping CSS/JS to
    a component using inline styles and a deferred script.

    Called from a layout via: <f:render partial="Examples/SiteHeader" />
    Arguments:
      navigationItems  array   Main navigation items (title, link, active, children)
      settings         array   Plugin/extension settings
      site             object  Current TYPO3 site object
-->

<!--
    Register every icon this partial uses.
    Safe to call from loops and multiple includes — duplicates are ignored.
-->
<ma:svgSprite register="EXT:my_sitepackage/Resources/Public/Icons/logo.svg" />
<ma:svgSprite register="EXT:my_sitepackage/Resources/Public/Icons/menu.svg" />
<ma:svgSprite register="EXT:my_sitepackage/Resources/Public/Icons/close.svg" />
<ma:svgSprite register="EXT:my_sitepackage/Resources/Public/Icons/search.svg" />
<ma:svgSprite register="EXT:my_sitepackage/Resources/Public/Icons/chevron-down.svg" />

<!--
    Scoped CSS for this component — inline so it is critical and available immediately.
    priority="true" ensures it lands in <head> alongside the critical reset.
    inline="true" avoids an extra HTTP request for a small component's styles.
-->
<ma:css identifier="site-header-styles" priority="true" inline="true">
    .site-header {
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 2rem;
        background: #fff;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .site-header__logo { display: flex; align-items: center; text-decoration: none; }
    .site-header__logo svg { width: 8.75rem; height: 2.5rem; }

    .site-nav { display: flex; align-items: center; gap: 0.25rem; }
    .site-nav__item { position: relative; }
    .site-nav__link {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.5rem 0.75rem;
        border-radius: 0.25rem;
        font-weight: 500;
        color: inherit;
        text-decoration: none;
    }
    .site-nav__link:hover,
    .site-nav__link[aria-current="page"] { background: #f1f3f5; }
    .site-nav__link--has-children .icon { transition: transform 200ms; }
    .site-nav__link--has-children[aria-expanded="true"] .icon { transform: rotate(180deg); }

    .site-nav__dropdown {
        position: absolute;
        top: calc(100% + 0.5rem);
        left: 0;
        min-width: 14rem;
        background: #fff;
        border-radius: 0.5rem;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        padding: 0.5rem;
        display: none;
    }
    .site-nav__dropdown[data-open] { display: block; }

    .site-nav__toggle {
        display: none; /* shown via media query below */
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.25rem;
    }
    .site-header__actions { display: flex; align-items: center; gap: 0.5rem; }

    @media (max-width: 768px) {
        .site-nav__toggle { display: flex; }
        .site-nav--main { display: none; }
        .site-nav--main[data-open] {
            display: flex;
            flex-direction: column;
            position: fixed;
            inset: 0;
            background: #fff;
            padding: 4rem 2rem 2rem;
            z-index: 200;
        }
    }
</ma:css>

<!--
    Scoped JS for the header — deferred, footer placement.
    Handles mobile menu toggle and dropdown navigation.
-->
<ma:js identifier="site-header-js">
    (function () {
        'use strict';

        // Mobile menu toggle
        var toggle   = document.querySelector('.site-nav__toggle');
        var mobileNav = document.querySelector('.site-nav--main');
        var closeBtn  = document.querySelector('.site-nav__close');

        if (toggle && mobileNav) {
            toggle.addEventListener('click', function () {
                var isOpen = mobileNav.hasAttribute('data-open');
                if (isOpen) {
                    mobileNav.removeAttribute('data-open');
                    toggle.setAttribute('aria-expanded', 'false');
                    document.body.style.overflow = '';
                } else {
                    mobileNav.setAttribute('data-open', '');
                    toggle.setAttribute('aria-expanded', 'true');
                    document.body.style.overflow = 'hidden';
                }
            });
        }

        // Dropdown navigation
        document.querySelectorAll('.site-nav__link--has-children').forEach(function (link) {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                var dropdown = this.nextElementSibling;
                var isOpen   = dropdown && dropdown.hasAttribute('data-open');

                // Close all dropdowns
                document.querySelectorAll('.site-nav__dropdown[data-open]').forEach(function (d) {
                    d.removeAttribute('data-open');
                    d.previousElementSibling.setAttribute('aria-expanded', 'false');
                });

                if (!isOpen && dropdown) {
                    dropdown.setAttribute('data-open', '');
                    this.setAttribute('aria-expanded', 'true');
                }
            });
        });

        // Close dropdowns on outside click
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.site-nav__item')) {
                document.querySelectorAll('.site-nav__dropdown[data-open]').forEach(function (d) {
                    d.removeAttribute('data-open');
                    d.previousElementSibling.setAttribute('aria-expanded', 'false');
                });
            }
        });
    }());
</ma:js>

<!-- ===================== MARKUP ===================== -->
<header class="site-header" role="banner">

    <a href="/" class="site-header__logo" aria-label="Homepage — {site.configuration.websiteTitle}">
        <ma:svgSprite use="icon-logo" aria-hidden="true" />
    </a>

    <!-- Mobile menu toggle button -->
    <button
        class="site-nav__toggle"
        type="button"
        aria-expanded="false"
        aria-controls="main-navigation"
        aria-label="Open navigation menu"
    >
        <ma:svgSprite use="icon-menu" width="24" height="24" aria-hidden="true" />
    </button>

    <!-- Main navigation -->
    <nav
        id="main-navigation"
        class="site-nav site-nav--main"
        aria-label="Main navigation"
    >
        <!-- Mobile close button (inside the panel) -->
        <button
            class="site-nav__close"
            type="button"
            aria-label="Close navigation menu"
        >
            <ma:svgSprite use="icon-close" width="24" height="24" aria-hidden="true" />
        </button>

        <f:for each="{navigationItems}" as="item">
            <div class="site-nav__item">
                <f:if condition="{item.children}">
                    <f:then>
                        <!-- Item with dropdown children -->
                        <button
                            class="site-nav__link site-nav__link--has-children"
                            aria-expanded="false"
                            aria-haspopup="true"
                        >
                            {item.title}
                            <ma:svgSprite
                                use="icon-chevron-down"
                                width="16"
                                height="16"
                                class="icon"
                                aria-hidden="true"
                            />
                        </button>
                        <ul class="site-nav__dropdown" role="menu">
                            <f:for each="{item.children}" as="child">
                                <li role="none">
                                    <a
                                        href="{child.link}"
                                        class="site-nav__link"
                                        role="menuitem"
                                        {f:if(condition: child.active, then: 'aria-current="page"')}
                                    >
                                        {child.title}
                                    </a>
                                </li>
                            </f:for>
                        </ul>
                    </f:then>
                    <f:else>
                        <!-- Simple navigation item -->
                        <a
                            href="{item.link}"
                            class="site-nav__link"
                            {f:if(condition: item.active, then: 'aria-current="page"')}
                        >
                            {item.title}
                        </a>
                    </f:else>
                </f:if>
            </div>
        </f:for>
    </nav>

    <!-- Header actions (search button, CTA) -->
    <div class="site-header__actions">
        <f:if condition="{settings.showSearch}">
            <a href="/search" class="btn btn--ghost btn--icon" aria-label="Search">
                <ma:svgSprite use="icon-search" width="20" height="20" aria-hidden="true" />
            </a>
        </f:if>
        <f:if condition="{settings.ctaLabel}">
            <a href="{settings.ctaLink}" class="btn btn--primary">
                {settings.ctaLabel}
            </a>
        </f:if>
    </div>

</header>
</html>
